<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ôn Tập KHTN Lớp 9 - Thi Vào 10</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
</head>
<body>

    <div class="header">
        <div class="header-inner d-flex align-items-center justify-content-center px-4">
            <div class="brand d-flex align-items-center">
                <div class="brand-badge me-3"><i class="fas fa-graduation-cap"></i></div>
                <div>
                    <h1 class="app-title mb-0" data-text="ÔN TẬP KHTN LỚP 9">Ôn Tập <span class="accent">KHTN Lớp 9</span></h1>
                    <p class="slogan mb-0">Thử thách 30 ngày — Chinh phục 3 môn, giành điểm mơ ước!</p>
                </div>
            </div>
            <div class="ms-3 d-flex align-items-center">
                <button id="soundToggle" class="btn btn-sm btn-light me-2" title="Bật/Tắt hiệu ứng">
                    <i class="fas fa-volume-up"></i>
                </button>
                <button id="bgToggle" class="btn btn-sm btn-light" title="Bật/Tắt nhạc nền">
                    <i class="fas fa-music"></i>
                </button>
                <div id="userArea" class="ms-3 d-flex align-items-center">
                    <!-- Filled by JS: show login/register or user name + logout -->
                    <!-- Fallback buttons in case JS not initialized yet -->
                    <button class="btn btn-sm btn-light" onclick="openAuthModal('login')">Đăng nhập</button>
                    <button class="btn btn-sm btn-primary ms-2" onclick="openAuthModal('register')">Đăng ký</button>
                </div>
                <div id="syncStatus" class="ms-3 sync-status small text-muted">Đồng bộ: Cục bộ</div>
                
            </div>
        </div>
    </div>

    <!-- SIDEBAR TRÁI - SỬA ID ĐÚNG -->
    <div class="sidebar sidebar-left">
        <div class="p-4">
            <h5 class="text-primary mb-3"><i class="fas fa-newspaper me-2"></i>Tin tức & Mẹo vặt</h5>
            <div class="list-group list-group-flush mb-4" id="newsList"></div> <!-- Đúng ID -->

            <h5 class="text-success mb-3"><i class="fas fa-trophy me-2"></i>Bảng Đua Top</h5>
            <ol class="list-group list-group-numbered" id="leaderboard"></ol> <!-- Đúng ID -->
        </div>
    </div>

    <!-- SIDEBAR PHẢI -->
    <div class="sidebar sidebar-right">
        <div class="p-4">
            <h5 class="text-info mb-4 text-center"><i class="fas fa-chart-line me-2"></i>Tiến Độ Học Tập</h5>
            <div id="progressBars">
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1"><span>Vật Lý</span><span id="lyPercent">0%</span></div>
                    <div class="progress" style="height:20px;"><div id="lyBar" class="progress-bar bg-danger" style="width:0%">0%</div></div>
                </div>
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1"><span>Hóa Học</span><span id="hoaPercent">0%</span></div>
                    <div class="progress" style="height:20px;"><div id="hoaBar" class="progress-bar bg-success" style="width:0%">0%</div></div>
                </div>
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-1"><span>Sinh Học</span><span id="sinhPercent">0%</span></div>
                    <div class="progress" style="height:20px;"><div id="sinhBar" class="progress-bar bg-warning text-dark" style="width:0%">0%</div></div>
                </div>
            </div>
            <hr>
            <p class="text-center"><strong id="totalProgress">Tổng tiến độ: 0%</strong></p>
            <p class="text-center mb-2"><strong id="bestScore">Điểm cao nhất: 0</strong></p>
            <p class="text-center"><strong id="achievements">Huy hiệu: Chưa có</strong></p>
        </div>
    </div>

    <!-- MAIN CONTENT - giữ nguyên 6 ô -->
    <div class="main-content">
        <div class="container py-5">
            <div class="options-grid" id="mainMenu">
                <!-- Ô 1 -->
                <div class="card card-option h-100 shadow-lg bg-white">
                    <div class="card-body text-center p-5">
                        <h3 class="card-title text-primary"><i class="fas fa-book fa-2x mb-3"></i><br>Ôn Lý Thuyết</h3>
                        <p class="card-text">Tóm tắt kiến thức 3 môn</p>
                        <button class="btn btn-outline-primary btn-lg mt-auto" onclick="window.location.href='pages/ly-thuyet.html'">Bắt đầu</button>
                    </div>
                </div>
                <!-- Ô 2 -->
                <div class="card card-option h-100 shadow-lg bg-white">
                    <div class="card-body text-center p-5">
                        <h3 class="card-title text-danger"><i class="fas fa-bolt fa-2x mb-3"></i><br>Vật Lý</h3>
                        <p class="card-text">Trắc nghiệm theo chủ đề</p>
                        <button class="btn btn-danger btn-lg mt-auto" onclick="showSubjectOptions('ly')">Bắt đầu</button>
                    </div>
                </div>
                <!-- Ô 3 -->
                <div class="card card-option h-100 shadow-lg bg-white">
                    <div class="card-body text-center p-5">
                        <h3 class="card-title text-success"><i class="fas fa-flask fa-2x mb-3"></i><br>Hóa Học</h3>
                        <p class="card-text">Trắc nghiệm theo chủ đề</p>
                        <button class="btn btn-success btn-lg mt-auto" onclick="showSubjectOptions('hoa')">Bắt đầu</button>
                    </div>
                </div>
                <!-- Ô 4 -->
                <div class="card card-option h-100 shadow-lg bg-white">
                    <div class="card-body text-center p-5">
                        <h3 class="card-title text-warning"><i class="fas fa-dna fa-2x mb-3"></i><br>Sinh Học</h3>
                        <p class="card-text">Trắc nghiệm theo chủ đề</p>
                        <button class="btn btn-warning btn-lg mt-auto text-dark" onclick="showSubjectOptions('sinh')">Bắt đầu</button>
                    </div>
                </div>
                <!-- Ô 5 -->
                <div class="card card-option h-100 shadow-lg bg-white">
                    <div class="card-body text-center p-5">
                        <h3 class="card-title text-info"><i class="fas fa-file-alt fa-2x mb-3"></i><br>Thi Thử Tổ Hợp</h3>
                        <p class="card-text">40 câu, 90 phút</p>
                        <button class="btn btn-info btn-lg mt-auto" onclick="startFullExam()">Bắt đầu thi</button>
                    </div>
                </div>
                <!-- Ô 6 -->
                <div class="card card-option h-100 shadow-lg bg-white">
                    <div class="card-body text-center p-5">
                        <h3 class="card-title text-secondary"><i class="fas fa-bolt-lightning fa-2x mb-3"></i><br>Ôn Nhanh Flashcard</h3>
                        <p class="card-text">Công thức, mẹo nhớ nhanh</p>
                        <button class="btn btn-secondary btn-lg mt-auto" onclick="window.location.href='pages/flashcard.html'">Bắt đầu</button>
                    </div>
                </div>
            </div>

            <div id="contentArea" class="mt-5"></div>
        </div>
    </div>

    <div class="footer">
        © 2026 - Trang ôn tập KHTN miễn phí cho học sinh lớp 9
    </div>

    <!-- Âm thanh -->
    <audio id="correctSound" preload="auto"><source src="sounds/correct.mp3" type="audio/mpeg"></audio>
    <audio id="wrongSound" preload="auto"><source src="sounds/wrong.mp3" type="audio/mpeg"></audio>
    <audio id="successSound" preload="auto"><source src="sounds/success.mp3" type="audio/mpeg"></audio>
    <audio id="clickSound" preload="auto"><source src="sounds/click.mp3" type="audio/mpeg"></audio>
    <audio id="hoverSound" preload="auto"><source src="sounds/hover.mp3" type="audio/mpeg"></audio>
    <audio id="bgMusic" preload="auto" loop>
        <source src="sounds/background.mp3" type="audio/mpeg">
    </audio>
    <audio id="completionMusic" preload="auto">
        <source src="sounds/completion.mp3" type="audio/mpeg">
    </audio>
    <audio id="encourageSound" preload="auto"><source src="sounds/encourage.mp3" type="audio/mpeg"></audio>

    <!-- Modal lựa chọn chủ đề & số câu -->
    <div id="subjectModal" class="khtn-modal" style="display:none;">
        <div class="khtn-modal-backdrop" onclick="closeSubjectModal()"></div>
        <div class="khtn-modal-dialog">
            <div class="khtn-modal-header">
                <h5 id="subjectModalTitle">Chọn cấu hình ôn tập</h5>
                <button class="khtn-modal-close" onclick="closeSubjectModal()">×</button>
            </div>
            <div class="khtn-modal-body">
                <div class="mb-3">
                    <label class="form-label">Chủ đề</label>
                    <select id="subjectTopicSelect" class="form-select">
                        <option value="all">Tất cả</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Số lượng câu hỏi</label>
                    <input id="subjectCountInput" type="number" class="form-control" min="1" max="50" value="10">
                    <div class="form-text">Tối đa sẽ giới hạn theo số câu có sẵn.</div>
                </div>
            </div>
            <div class="khtn-modal-footer">
                <button class="btn btn-secondary me-2" onclick="closeSubjectModal()">Hủy</button>
                <button class="btn btn-primary" onclick="startFilteredQuiz(currentModalSubject)">Bắt đầu</button>
            </div>
        </div>
    </div>

    <!-- Modal đăng nhập / đăng ký -->
    <div id="authModal" class="khtn-modal" style="display:none;">
        <div class="khtn-modal-backdrop" onclick="closeAuthModal()"></div>
        <div class="khtn-modal-dialog">
            <div class="khtn-modal-header">
                <h5 id="authModalTitle">Đăng nhập</h5>
                <button class="khtn-modal-close" onclick="closeAuthModal()">×</button>
            </div>
            <div class="khtn-modal-body">
                <div id="authForms">
                    <div id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Tên đăng nhập</label>
                            <input id="loginUsername" class="form-control" placeholder="Tên đăng nhập">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mật khẩu</label>
                            <input id="loginPassword" type="password" class="form-control" placeholder="Mật khẩu">
                        </div>
                    </div>
                    <div id="registerForm" style="display:none;">
                        <div class="mb-3">
                            <label class="form-label">Tên đăng nhập</label>
                            <input id="regUsername" class="form-control" placeholder="Tên đăng nhập">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mật khẩu</label>
                            <input id="regPassword" type="password" class="form-control" placeholder="Mật khẩu">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nhập lại mật khẩu</label>
                            <input id="regPassword2" type="password" class="form-control" placeholder="Nhập lại mật khẩu">
                        </div>
                    </div>
                </div>

                        
            </div>
            <div class="khtn-modal-footer">
                <button id="switchToRegister" class="btn btn-link me-auto" onclick="switchAuthMode('register')">Đăng ký</button>
                <button class="btn btn-secondary me-2" onclick="closeAuthModal()">Hủy</button>
                <button id="authPrimaryBtn" class="btn btn-primary" onclick="handleAuthPrimary()">Đăng nhập</button>
            </div>
        </div>
    </div>

    <!-- Firebase (compat) scripts for optional remote leaderboard sync -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js" defer></script>
    <script src="js/firebase-config.js" defer></script>

    <!-- Question data must load before app scripts that reference them -->
    <script src="js/questions-ly.js" defer></script>
    <script src="js/questions-hoa.js" defer></script>
    <script src="js/questions-sinh.js" defer></script>

    <script src="js/storage.js" defer></script>

    <!-- Scripts - THỨ TỰ QUAN TRỌNG -->
    <script src="js/main.js" defer></script>
    <script src="js/quiz.js" defer></script>
    <script src="js/full-exam.js" defer></script>
</body>
</html>